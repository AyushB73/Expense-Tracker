<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current View Dropdown - Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
        .error-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }
        .card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .card h3 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 14px;
        }
        .card span {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .console-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .console-log .log-info { color: #4fc3f7; }
        .console-log .log-success { color: #81c784; }
        .console-log .log-error { color: #e57373; }
        .console-log .log-warning { color: #ffb74d; }
    </style>
</head>
<body>
    <h1>üîç Current View Dropdown - Debug Test</h1>
    
    <div class="info-box">
        <strong>Purpose:</strong> This page helps debug the "Current View" dropdown issue in the Transaction History section.
        <br><strong>Instructions:</strong> Open the browser console (F12) and watch for log messages as you interact with the dropdown.
    </div>

    <div class="test-section">
        <h2>1. Test Dropdown</h2>
        <p>Select a site from the dropdown below:</p>
        
        <div class="card">
            <h3>Current View</h3>
            <select id="site-filter-summary">
                <option value="">All Sites</option>
                <option value="Main Office">Main Office</option>
                <option value="Project Alpha">Project Alpha</option>
                <option value="Site Beta">Site Beta</option>
            </select>
        </div>
        
        <button onclick="testDropdownValue()">Check Dropdown Value</button>
        <button onclick="testFilterLogic()">Test Filter Logic</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-section">
        <h2>2. Summary Cards (Should Update)</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="card">
                <h3>Total Expenses</h3>
                <span id="total-debits">‚Çπ0.00</span>
            </div>
            <div class="card">
                <h3>Total Payments</h3>
                <span id="total-credits">‚Çπ0.00</span>
            </div>
            <div class="card">
                <h3>Outstanding Balance</h3>
                <span id="net-balance">‚Çπ0.00</span>
            </div>
            <div class="card">
                <h3>Total Entries</h3>
                <span id="expense-count">0</span>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. Test Data</h2>
        <button onclick="loadTestData()">Load Test Expenses</button>
        <button onclick="showTestData()">Show Test Data</button>
        <div id="test-data-display"></div>
    </div>

    <div class="test-section">
        <h2>4. Console Output</h2>
        <div id="console-output" class="console-log">
            <div class="log-info">Console output will appear here...</div>
        </div>
    </div>

    <script>
        // Test expenses data
        let testExpenses = [
            { id: 1, site: 'Main Office', type: 'debit', amount: 50000, description: 'Office supplies', date: '2026-01-01' },
            { id: 2, site: 'Main Office', type: 'credit', amount: 30000, description: 'Payment to vendor', date: '2026-01-02' },
            { id: 3, site: 'Project Alpha', type: 'debit', amount: 100000, description: 'Construction materials', date: '2026-01-01' },
            { id: 4, site: 'Project Alpha', type: 'credit', amount: 50000, description: 'Partial payment', date: '2026-01-03' },
            { id: 5, site: 'Site Beta', type: 'debit', amount: 75000, description: 'Equipment rental', date: '2026-01-02' },
            { id: 6, site: 'Site Beta', type: 'credit', amount: 75000, description: 'Full payment', date: '2026-01-03' }
        ];

        let currentSiteFilter = '';

        // Console logging
        function logToConsole(message, type = 'info') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = `log-${type}`;
            const logEntry = `<div class="${logClass}">[${timestamp}] ${message}</div>`;
            consoleOutput.innerHTML += logEntry;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '<div class="log-info">Console cleared...</div>';
        }

        // Load test data
        function loadTestData() {
            logToConsole('Loading test expenses...', 'info');
            logToConsole(`Loaded ${testExpenses.length} test expenses`, 'success');
            updateSummary();
        }

        // Show test data
        function showTestData() {
            const display = document.getElementById('test-data-display');
            display.innerHTML = '<pre>' + JSON.stringify(testExpenses, null, 2) + '</pre>';
            logToConsole('Test data displayed', 'info');
        }

        // Test dropdown value
        function testDropdownValue() {
            const dropdown = document.getElementById('site-filter-summary');
            const value = dropdown.value;
            const text = dropdown.options[dropdown.selectedIndex].text;
            
            logToConsole('=== Dropdown Test ===', 'info');
            logToConsole(`Selected value: "${value}"`, 'info');
            logToConsole(`Selected text: "${text}"`, 'info');
            logToConsole(`Current filter: "${currentSiteFilter}"`, 'info');
            
            if (value === '') {
                logToConsole('‚úì "All Sites" is selected', 'success');
            } else {
                logToConsole(`‚úì Site "${value}" is selected`, 'success');
            }
        }

        // Test filter logic
        function testFilterLogic() {
            const dropdown = document.getElementById('site-filter-summary');
            const filterValue = dropdown.value;
            
            logToConsole('=== Filter Logic Test ===', 'info');
            logToConsole(`Filter value: "${filterValue}"`, 'info');
            logToConsole(`Total expenses: ${testExpenses.length}`, 'info');
            
            let filteredExpenses = testExpenses;
            if (filterValue) {
                filteredExpenses = testExpenses.filter(exp => exp.site === filterValue);
                logToConsole(`Filtered expenses: ${filteredExpenses.length}`, 'info');
                
                // Show which expenses match
                filteredExpenses.forEach(exp => {
                    logToConsole(`  - ${exp.description} (${exp.site})`, 'info');
                });
            } else {
                logToConsole('No filter applied - showing all expenses', 'info');
            }
            
            // Calculate totals
            const totalDebits = filteredExpenses
                .filter(exp => exp.type === 'debit')
                .reduce((sum, exp) => sum + exp.amount, 0);
            
            const totalCredits = filteredExpenses
                .filter(exp => exp.type === 'credit')
                .reduce((sum, exp) => sum + exp.amount, 0);
            
            const balance = totalDebits - totalCredits;
            
            logToConsole(`Total Debits: ‚Çπ${totalDebits.toLocaleString('en-IN')}`, 'success');
            logToConsole(`Total Credits: ‚Çπ${totalCredits.toLocaleString('en-IN')}`, 'success');
            logToConsole(`Balance: ‚Çπ${balance.toLocaleString('en-IN')}`, 'success');
            
            // Update summary cards
            updateSummaryCards(totalDebits, totalCredits, balance, filteredExpenses.length);
        }

        // Update summary
        function updateSummary() {
            logToConsole('=== Updating Summary ===', 'info');
            
            let filteredExpenses = testExpenses;
            if (currentSiteFilter) {
                filteredExpenses = testExpenses.filter(exp => exp.site === currentSiteFilter);
                logToConsole(`Filtering by: ${currentSiteFilter}`, 'info');
            }
            
            const totalDebits = filteredExpenses
                .filter(exp => exp.type === 'debit')
                .reduce((sum, exp) => sum + exp.amount, 0);
            
            const totalCredits = filteredExpenses
                .filter(exp => exp.type === 'credit')
                .reduce((sum, exp) => sum + exp.amount, 0);
            
            const balance = totalDebits - totalCredits;
            
            updateSummaryCards(totalDebits, totalCredits, balance, filteredExpenses.length);
            logToConsole('Summary updated', 'success');
        }

        // Update summary cards
        function updateSummaryCards(debits, credits, balance, count) {
            document.getElementById('total-debits').textContent = `‚Çπ${debits.toLocaleString('en-IN')}`;
            document.getElementById('total-credits').textContent = `‚Çπ${credits.toLocaleString('en-IN')}`;
            document.getElementById('net-balance').textContent = `‚Çπ${Math.abs(balance).toLocaleString('en-IN')}`;
            document.getElementById('expense-count').textContent = count;
        }

        // Dropdown change event
        document.getElementById('site-filter-summary').addEventListener('change', function(e) {
            const value = e.target.value;
            const text = e.target.options[e.target.selectedIndex].text;
            
            logToConsole('=== Dropdown Changed ===', 'warning');
            logToConsole(`New value: "${value}"`, 'warning');
            logToConsole(`New text: "${text}"`, 'warning');
            
            currentSiteFilter = value;
            updateSummary();
            
            logToConsole('Filter applied and summary updated', 'success');
        });

        // Initialize
        logToConsole('Test page loaded', 'success');
        logToConsole('Click "Load Test Expenses" to begin testing', 'info');
    </script>
</body>
</html>
